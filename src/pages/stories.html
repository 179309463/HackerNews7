<template>
        <div class="page" data-name="stories">
            <div class="navbar">
              <div class="navbar-inner">
                <div class="left">
                  <a href="#" class="link icon-only panel-open" data-panel="left">
                    <i class="icon f7-icons ios-only">menu</i>
                    <i class="icon material-icons md-only">menu</i>
                  </a>
                </div>
                <div class="title sliding">HackerNews7</div>
              </div>
            </div>
            <div class="toolbar tabbar">
              <div class="toolbar-inner">
                {{#each endpoints}}
                    <a href="#tab-{{this.label}}" class="tab-link {{#js_if '@root.currentTab === @index'}}tab-link-active{{/js_if}}" @click="loadStories({{@index}})">{{this.label}}</a>
                {{/each}}
              </div>
            </div>
            <div class="page-content">
                <div class="list">
                    <ul>
                    {{#stories}}
                        <li class="item-content">
                            <div class="item-inner">
                                <div class="item-title">{{title}}</div>
                            </div>
                        </li>
                    {{/stories}}
                    </ul>
                </div>
            </div>
    </template>
    <script>
        return {
            data() {
                return {
                    currentTab: 0,
                    stories: null,
                    endpoints: [
                        {
                            label: 'top',
                            endpoint: 'news',
                        },
                        {
                            label: 'new',
                            endpoint: 'newest',
                        },
                        {
                            label: 'ask',
                            endpoint: 'ask',
                        },
                        {
                            label: 'jobs',
                            endpoint: 'jobs',
                        },
                        {
                            label: 'show',
                            endpoint: 'show',
                        },
                    ],
                }
            },
            methods: {
                loadStories(endpointIndex) {
                    var self = this;
                    var app = self.$app;
                    app.request.json('https://api.hnpwa.com/v0/' + this.endpoints[endpointIndex].endpoint + '.json', (stories) => {
                        self.$setState({
                            stories: stories,
                            currentTab: endpointIndex,
                        })
                    })
                }
            },
            on: {
                pageInit() {
                    var self = this;
                    self.loadStories(0);
                },
            },
        }
    </script>